# 울타리 잘라내기

## 문제
너비가 같은 N개의 나무 판자를 붙여 세운 울타리가 있습니다. 시간이 지남에 따라 판자들이 부러지거나 망가져 높이가 다 달라진 관계로 울타리를 통째로 교체하기로 했습니다. 이 때 버리는 울타리의 일부를 직사각형으로 잘라내 재활용하고 싶습니다. 그림 (b)는 (a)의 울타리에서 잘라낼 수 있는 많은 직사각형 중 가장 넓은 직사각형을 보여줍니다. 울타리를 구성하는 각 판자의 높이가 주어질 때, 잘라낼 수 있는 직사각형의 최대 크기를 계산하는 프로그램을 작성하세요. 단 (c)처럼 직사각형을 비스듬히 잘라낼 수는 없습니다.

판자의 너비는 모두 1이라고 가정합니다.

![이미지](https://algospot.com/media/judge-attachments/506874700c7251881727ee4e70a1d502/fence.png)

## 입력
첫 줄에 테스트 케이스의 개수 C (C≤50)가 주어진다. 각 테스트 케이스의 첫 줄에는 판자의 수 N (1≤N≤20000)이 주어진다. 그 다음 줄에는 N개의 정수로 왼쪽부터 각 판자의 높이가 순서대로 주어진다. 높이는 모두 10,000 이하의 자연수이다.

## 출력
각 테스트 케이스당 정수 하나를 한 줄에 출력한다. 이 정수는 주어진 울타리에서 얻을 수 있는 최대 직사각형의 크기를 나타내야 한다.

## 예제 입력
```
3
7
7 1 5 9 6 7 3
7
1 4 4 4 4 1 1
4
1 8 2 2
```

## 예제 출력
```
20
16
8
```

## 알고리즘 분류
* 분할 정복
* 브루트 포스
* 분할 정복을 이용한 최대 직사각형의 크기 계산

## 문제해결

히스토그램에서 최대 크기를 갖는 직사각형 문제로도 알려진 문제이다.

### 1. 브루트 포스 

가장 간단한 방법으로, 모든 경우의 수를 다 따져보는 방법이다. 이 방법은 시간 복잡도가 O(N^2)이므로, N의 최대값이 20,000이므로 4억번의 연산을 수행해야 한다. 이는 제한 시간 내에 불가능하다.

### 2. 분할 정복

분할 정복을 이용하면 시간 복잡도를 O(NlogN)으로 줄일 수 있다. 이 방법은 다음과 같다.

#### 아이디어
이 문제는 다음과 같이 작은 문제로 분할할 수 있다. 

우선, 울타리를 두 부분으로 나눈다.
- 최대 크기 직사각형이 왼쪽 부분에 존재한다.
- 최대 크기 직사각형이 오른쪽 부분에 존재한다.
- 최대 크기 직사각형이 왼쪽 부분과 오른쪽 부분에 걸쳐 있다.

최대 크기 직사각형이 왼쪽이나 오른쪽에만 존재하는 경우 재귀 호출로 해결할 수 있다.

최대 크기 직사각형이 양쪽에 걸쳐 있는 경우에는 <strong> 가운데 두 판자를 반드시 포함한다</strong>는 점에서 문제 해결 아이디어를 찾을 수 있다.

이후 왼쪽 부분과 오른쪽 부분에 걸쳐 있는 최대 크기 직사각형을 각각 구하고, 이 중 큰 것을 선택하여 직사각형을 확장해 나간다.


> [양쪽에 걸쳤을 때 큰 쪽으로만 확장하는 그리디를 적용해도 되는 이유]
> 
> 전제 
>
> 1. 확장 시에 높이는 증가할 수 없다. 
> 2. 넓이는 무조건 1씩 증가함
>
> 최대한으로 양쪽으로 이동하는 행위는 결국
>
> 모든 직사각형의 높이를 내림차순으로 배열한 후, 
> 초기 높이에서 작아지는 방향으로 직사각형의 높이를 변화시키는 것으로 계산하는 방법과 동일함
>
> 따라서, 양쪽으로 확장하는 행위는 결국 최대 직사각형의 넓이를 구하는 것과 동일함



### 3. 스위핑 기법과 스택을 결합

스위핑 기법과 스택을 결합하면 시간 복잡도를 O(N)으로 줄일 수 있다. 이 방법은 다음과 같다.

<!-- ### 4. 상호 배타적 집합

상호 배타적 집합을 이용하면 시간 복잡도를 O(NlogN)으로 줄일 수 있다. 이 방법은 다음과 같다. -->


---

***본 문제의 출처는 '알고스팟(https://algospot.com)'에 있으며, 풀이 소스코드의 일부는 '알고리즘 문제해결 전략'을 참고하여 작성되었습니다.***